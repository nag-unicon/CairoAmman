    SUBROUTINE CAB.ACH.DIRECT.DEBIT.INPUT
    $INCLUDE T24.BP I_COMMON
    $INCLUDE T24.BP I_EQUATE
    $INCLUDE T24.BP I_F.ACCOUNT
    $INCLUDE T24.BP I_F.CUSTOMER
    $INCLUDE CAB.BP I_F.CAB.ACH.DIRECT.DEBIT


    GOSUB INITIALISE
    GOSUB PROCESS
    RETURN

INITIALISE:
    FN.ALTERNATE.ACCT = 'F.ALTERNATE.ACCOUNT' ; F.ALTERNATE.ACCT = ''
    CALL OPF(FN.ALTERNATE.ACCT,F.ALTERNATE.ACCT)

    FN.ACCOUNT = 'F.ACCOUNT' ; F.ACCOUNT = ''
    CALL OPF(FN.ACCOUNT,F.ACCOUNT)

    FN.MNEMONIC.CUSTOMER = 'F.MNEMONIC.CUSTOMER'  ; F.MNEMONIC.CUSTOMER = ''
    CALL OPF(FN.MNEMONIC.CUSTOMER,F.MNEMONIC.CUSTOMER)

    FN.CUSTOMER = 'F.CUSTOMER'  ; F.CUSTOMER = ''
    CALL OPF(FN.CUSTOMER,F.CUSTOMER)
    RETURN


PROCESS:


*    AF = ACH.DD.CR.CUST.ACCT

    IF R.NEW(ACH.DD.CR.CUST.ACCT) NE '' THEN
        GOSUB READ.ACCOUNT
        R.NEW(ACH.DD.CR.CUST.NAME) = YR.CUST.NAME
    END


*    AF = ACH.DD.DR.BANK.CODE
    IF R.NEW(ACH.DD.DR.BANK.CODE) NE '' THEN
        GOSUB READ.DE.BIC
    END

    RETURN


READ.ACCOUNT:
    YR.ALT.ACCT = R.NEW(ACH.DD.CR.CUST.ACCT)
    R.ALT.ACCT = '' ; ALT.ERR = '' ; YR.ACCT = ''
    CALL F.READ(FN.ALTERNATE.ACCT,YR.ALT.ACCT,R.ALT.ACCT,F.ALTERNATE.ACCT,ALT.ERR)
    YR.ACCT = R.ALT.ACCT<1>

    IF YR.ACCT THEN
        R.ACCT = '' ; ACCT.ERR = ''
        CALL F.READ(FN.ACCOUNT,YR.ACCT,R.ACCT,F.ACCOUNT,ACCT.ERR)
        YR.CUSTOMER = R.ACCT<AC.CUSTOMER>
        GOSUB READ.CUSTOMER
        YR.CUST.NAME = R.CUSTOMER<EB.CUS.SHORT.NAME,1>
    END

    RETURN

READ.DE.BIC:
    YR.MNEMONIC = R.NEW(AF)[1,7]:'X'
    R.MNENOMIC.CUSTOMER = '' ; MNEMONIC.ERR = ''
    CALL F.READ(FN.MNEMONIC.CUSTOMER,YR.MNEMONIC,R.MNENOMIC.CUSTOMER,F.MNEMONIC.CUSTOMER,MNEMONIC.ERR)

    YR.CUSTOMER = R.MNENOMIC.CUSTOMER<1>
    GOSUB READ.CUSTOMER
    IF R.CUSTOMER THEN
        R.NEW(ACH.DD.DR.BANK.NAME) = R.CUSTOMER<EB.CUS.SHORT.NAME,1>
    END
    RETURN

READ.CUSTOMER:

    R.CUSTOMER = '' ; CUST.ERR = ''
    CALL F.READ(FN.CUSTOMER,YR.CUSTOMER,R.CUSTOMER,F.CUSTOMER,CUST.ERR)

    RETURN
