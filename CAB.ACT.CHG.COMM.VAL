    SUBROUTINE CAB.ACT.CHG.COMM.VAL
    $INSERT I_COMMON
    $INSERT I_EQUATE
    $INSERT I_F.AA.ARRANGEMENT.ACTIVITY
    $INSERT I_F.ACCOUNT
    $INSERT I_F.AA.CHARGE
    $INSERT I_F.AA.ACTIVITY.CHARGES
    $INSERT I_F.AA.PAYMENT.SCHEDULE
    $INSERT I_AA.APP.COMMON
    $INSERT I_AA.ACTION.CONTEXT


*    GOSUB INIT
*    GOSUB PROCESS.INIT

    RETURN

INIT:
*****
    LOC.VAL.FIELD =''
    PRO.STATUS = c_arrActivityStatus["-",1,1]
    ARRANGEMENT.ID = AA$ARR.ID          ;* Arrangement contract Id
    ACTIVITY.ID = AA$CURR.ACTIVITY
    COMM.PROP = AA$PROPERTY.ID

    RETURN

PROCESS.INIT:
*************

    IF PRO.STATUS EQ "UNAUTH" AND ACTIVITY.ID EQ 'LENDING-NEW-ARRANGEMENT' THEN
        GOSUB PROCESS.VALIDATE
    END
    RETURN

PROCESS.VALIDATE:
*****************

    CALL AA.GET.PROPERTY.RECORD('', ARRANGEMENT.ID, 'ANNUALCOMM', EFFECTIVE.DATE, 'CHARGE', '', CHARGE.RECORD, R.ERR)

    CALL GET.LOC.REF('AA.ARR.CHARGE','ANNUAL.COMM',ST.POS)
    COMM.TYPE.ID = CHARGE.RECORD<AA.CHG.LOCAL.REF,ST.POS>


    BEGIN CASE

    CASE COMM.TYPE.ID EQ '4'
        GOSUB UPD.ANN.COM
    CASE 1
        GOSUB CLR.ANN.COM
    END CASE

    RETURN

CLR.ANN.COM:
************

    LOCATE 'LENDING-CALC-CHARGE' IN R.NEW(AA.ACT.CHG.ACTIVITY.ID)<1,1> SETTING AC.POS THEN
        LOCATE 'ANNUALCOMM' IN R.NEW(AA.ACT.CHG.CHARGE)<1,AC.POS,1> SETTING MC.POS THEN

            R.NEW(AA.ACT.CHG.ACTIVITY.ID)<1,AC.POS> = ''
            R.NEW(AA.ACT.CHG.CHARGE)<1,AC.POS,1> = ''
            R.NEW(AA.ACT.CHG.APP.METHOD)<1,AC.POS,1>  = ''
        END
    END
    RETURN

UPD.ANN.COM:
************

    RETURN


    RETURN
